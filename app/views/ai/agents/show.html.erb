<div class="container-fluid py-4">
  <div class="row">
    <!-- Left sidebar - Agent details and conversations list -->
    <div class="col-md-4 col-lg-3 d-flex flex-column" style="height: calc(100vh - 80px);">
      <!-- Agent details card -->
      <div class="card shadow-sm mb-3">
        <div class="card-body p-3">
          <div class="d-flex align-items-center mb-3">
            <img src="https://via.placeholder.com/150" class="rounded-circle me-3" style="width: 60px; height: 60px; object-fit: cover;" alt="<%= @agent.name %>">
            <div>
              <h5 class="mb-0"><%= @agent.name.humanize %></h5>
              <span class="badge bg-success">Online</span>
            </div>
          </div>
          
          <div class="small text-muted mb-3">
            <%= @agent.description %>
          </div>
          
          <div class="d-grid">
            <%= link_to 'Start New Conversation', ai_agent_conversations_path(@agent), method: :post, class: 'btn btn-primary', data: { turbo_method: :post } %>
          </div>
        </div>
      </div>
      
      <!-- Conversations list -->
      <div class="card shadow-sm flex-grow-1 d-flex flex-column">
        <div class="card-header bg-white py-3">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Conversations</h5>
            <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#conversationsFilter">
              <i class="bi bi-funnel"></i>
            </button>
          </div>
          
          <div class="collapse mt-2" id="conversationsFilter">
            <div class="input-group input-group-sm">
              <input type="text" class="form-control" placeholder="Search conversations...">
              <button class="btn btn-outline-secondary" type="button">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </div>
        </div>
        
        <div class="card-body p-0 overflow-auto flex-grow-1" style="max-height: 100%;">
          <div class="list-group list-group-flush border-bottom" id="conversations-list">
            <%= render partial: "ai/conversations/conversation", collection: @agent.conversations.where(user: current_user).order(created_at: :desc) %>
            
            <% if @agent.conversations.where(user: current_user).empty? %>
              <div class="text-center py-5 text-muted">
                <i class="bi bi-chat-dots fs-1 mb-3"></i>
                <p>No conversations yet</p>
                <small>Start a new conversation to begin chatting</small>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Right side - Chat area -->
    <div class="col-md-8 col-lg-9 d-flex flex-column" style="height: calc(100vh - 80px);">
      <div class="card shadow-sm h-100 d-flex flex-column">
        <!-- Chat header -->
        <div class="card-header bg-white py-3 border-bottom">
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
              <h5 class="mb-0" id="current-conversation-title">Select a conversation</h5>
              <span class="badge bg-primary ms-2 conversation-status d-none">Active</span>
            </div>
            <div class="btn-group">
              <button class="btn btn-sm btn-outline-secondary" title="Settings">
                <i class="bi bi-gear"></i>
              </button>
              <button class="btn btn-sm btn-outline-secondary" title="Information">
                <i class="bi bi-info-circle"></i>
              </button>
            </div>
          </div>
        </div>
        
        <!-- Chat messages area -->
        <div class="card-body p-0 overflow-auto flex-grow-1" id="messages-container">
          <div class="d-flex flex-column align-items-center justify-content-center h-100 text-center text-muted p-4" id="empty-state">
            <div class="mb-4">
              <i class="bi bi-robot fs-1"></i>
            </div>
            <h4><%= @agent.name.humanize %></h4>
            <p class="mb-4"><%= @agent.instructions %></p>
            <div class="bg-light rounded p-3 mb-3 w-75">
              <h6>Tools</h6>
              <p class="small mb-0"><%= @agent.tools.present? ? @agent.tools : "No specific tools configured" %></p>
            </div>
            <p>Choose a conversation from the list or create a new one to start chatting</p>
          </div>
          
          <div id="messages" class="d-none">
            <!-- Messages will be loaded here -->
          </div>
        </div>
        
        <!-- Chat input area -->
        <div class="card-footer bg-white p-3 border-top d-none" id="message-form-container">
          <form id="message-form" class="d-flex">
            <div class="input-group">
              <textarea class="form-control" placeholder="Type your message..." rows="1" id="message-input"></textarea>
              <button class="btn btn-primary" type="submit">
                <i class="bi bi-send"></i>
              </button>
            </div>
          </form>
          <div class="d-flex justify-content-between align-items-center mt-2">
            <div class="small text-muted">
              <i class="bi bi-info-circle"></i> Press Enter to send, Shift+Enter for new line
            </div>
            <div>
              <button class="btn btn-sm btn-link text-muted p-0" title="Upload file">
                <i class="bi bi-paperclip"></i>
              </button>
              <button class="btn btn-sm btn-link text-muted p-0 ms-2" title="Voice message">
                <i class="bi bi-mic"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('turbo:load', function() {
    // Auto-resize textarea as user types
    const messageInput = document.getElementById('message-input');
    if (messageInput) {
      messageInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });
    }
    
    // Handle conversation selection
    const conversationLinks = document.querySelectorAll('.conversation-link');
    conversationLinks.forEach(link => {
      link.addEventListener('click', function() {
        // Update active conversation
        document.querySelectorAll('.conversation-link').forEach(l => l.classList.remove('active'));
        this.classList.add('active');
        
        // Show message form and hide empty state
        document.getElementById('empty-state').classList.add('d-none');
        document.getElementById('messages').classList.remove('d-none');
        document.getElementById('message-form-container').classList.remove('d-none');
        
        // Update conversation title
        document.getElementById('current-conversation-title').textContent = this.querySelector('.conversation-title').textContent;
        document.querySelector('.conversation-status').classList.remove('d-none');
        
        // Load messages (would be implemented with Turbo Streams in a real app)
      });
    });
  });
</script>

<style>
  .conversation-link {
    transition: all 0.2s ease;
    border-left: 3px solid transparent;
  }
  
  .conversation-link:hover {
    background-color: rgba(13, 110, 253, 0.05);
  }
  
  .conversation-link.active {
    background-color: rgba(13, 110, 253, 0.1);
    border-left: 3px solid #0d6efd;
  }
  
  #message-input {
    resize: none;
    max-height: 120px;
    overflow-y: auto;
  }
</style>
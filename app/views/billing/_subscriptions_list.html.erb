<% if subscriptions.present? %>
  <div class="table-responsive">
    <table class="table align-middle mb-0">
      <thead>
        <tr>
          <th>Name</th>
          <th>Plan</th>
          <th>Price</th>
          <th>Status</th>
          <th>Current Period</th>
          <th>Quantity</th>
        </tr>
      </thead>
      <tbody>
        <% subscriptions.each do |sub| %>
          <% plan = BillingPlans.plan_for_price_id(sub.processor_plan.to_s) %>
          <tr id="subscription_<%= sub.id %>">
            <td><%= (sub.name.to_s == 'default' ? 'Primary' : sub.name.to_s.titleize) %></td>
            <td>
              <% if plan.present? %>
                <%= plan.name %>
              <% else %>
                <code><%= sub.processor_plan %></code>
              <% end %>
            </td>
            <td>
              <% if plan.present? %>
                <%= plan_display_price(plan.key, plan.price_cents) %>
              <% else %>
                <span class="text-muted">—</span>
              <% end %>
            </td>
            <td>
              <% status = sub.status.to_s %>
              <% badge_class = case status
                 when 'active' then 'bg-success'
                 when 'trialing' then 'bg-info'
                 when 'past_due' then 'bg-warning'
                 when 'canceled', 'unpaid', 'incomplete_expired' then 'bg-secondary'
                 else 'bg-secondary'
               end %>
              <span class="badge <%= badge_class %>" aria-label="Subscription status: <%= status %>"><%= status %></span>
            </td>
            <td>
              <% if sub.respond_to?(:on_trial?) && sub.on_trial? && sub.respond_to?(:trial_ends_at) && sub.trial_ends_at.present? %>
                Trial ends: <%= l(sub.trial_ends_at, format: :long) %>
              <% elsif sub.respond_to?(:current_period_start) && sub.current_period_start && sub.current_period_end %>
                <%= l(sub.current_period_start, format: :short) %> — <%= l(sub.current_period_end, format: :short) %>
              <% elsif sub.respond_to?(:ends_at) && sub.ends_at.present? %>
                Ends: <%= l(sub.ends_at, format: :long) %>
              <% else %>
                <span class="text-muted">—</span>
              <% end %>
            </td>
            <td><%= sub.quantity %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p class="text-muted mb-0">No subscriptions.</p>
<% end %>
